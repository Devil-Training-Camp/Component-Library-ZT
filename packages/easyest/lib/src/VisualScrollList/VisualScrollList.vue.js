"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");require("./style/index.css");const L=["data-index"],z={__name:"VisualScrollList",props:{listData:{type:Array,default:()=>[]},estimatedItemSize:{type:Number,default:100},cacheCount:{type:Number,default:5}},setup(x){const d=x;t.ref(null);const u=t.ref(null),P=t.ref(null);t.ref(null);let m=!1,v=0,D=!0;const a=t.reactive({screenHeight:0,start:0,allData:[],startOffset:0,pillarDomHeight:0,contentListOffset:0});let s=[];const E=()=>{d.listData.forEach((l,e)=>{a.allData.push({...l,arrPos:e}),s.push({arrPos:e,startPos:e*d.estimatedItemSize,endPos:(e+1)*d.estimatedItemSize,height:d.estimatedItemSize})})};t.onMounted(()=>{E()});const I=t.computed(()=>u.value?u.value.offsetHeight:0),S=t.computed(()=>{if(!a.allData||a.allData.length<=0)return 0;const l=s;let e=a.start,n=l[e].height;const o=I.value;for(;n<o;)e++,n+=l[e].height;return e+=1,e+1}),C=t.computed(()=>`transform:translate(0,${a.contentListOffset}px)`),_=t.computed(()=>{const l=d.cacheCount,e=Math.max(0,a.start-l),n=Math.min(S.value+l,a.allData.length);return console.log(S.value,l,e,n),a.allData.slice(e,n)}),k=l=>{if(m)return;const e=l.target;if(!e)return;const{scrollTop:n}=e;D=n-v>=0,v=n,a.start=H(s,n),a.startOffset=s[a.start].endPos-n;const o=d.cacheCount,r=Math.max(0,a.start-o);a.contentListOffset=s[r].startPos};function H(l,e){let n=0,o=l.length-1,r;for(;n<=o;){const i=Math.trunc((n+o)/2),c=l[i].endPos;if(c===e)return i+1;c<e?n=i+1:c>e&&((r===void 0||r>i)&&(r=i),o=i-1)}return r}const B=()=>{const l=u.value;if(l&&a.startOffset>0&&!D){const e=s[a.start].endPos-a.startOffset;m=!0,t.nextTick(()=>{l.scrollTo({top:e}),m=!1})}},T=()=>{const l=P.value;if(!l)return;const e=l.children,n=s;for(let o=0;o<e.length;o++){const r=e[o],i=r.dataset.index;if(!i)continue;const g=parseInt(i),c=n[g];if(!c)continue;const{height:M}=r.getBoundingClientRect(),y=c.height,p=y-M;if(p!=0){c.height=y-p,c.endPos=c.endPos-p;for(let f=g+1;f<n.length;f++){const h=n[f],O=n[f-1];h.startPos=O.endPos,h.endPos=h.startPos+h.height}}}a.pillarDomHeight=s.length>0?s[s.length-1].endPos:0,B()};return t.onUpdated(()=>{t.nextTick(()=>{T()})}),(l,e)=>(t.openBlock(),t.createElementBlock("div",null,[t.createElementVNode("div",{ref_key:"listContainer",ref:u,class:"ea-list-container",onScroll:k},[t.createElementVNode("div",{class:"ea-pillarDom",style:t.normalizeStyle({height:`${a.pillarDomHeight}px`})},null,4),t.createElementVNode("div",{ref_key:"listContent",ref:P,class:"ea-list-content",style:t.normalizeStyle(C.value)},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(_.value,n=>(t.openBlock(),t.createElementBlock("div",{key:n.id,"data-index":n.arrPos,class:"ea-list-item"},[t.renderSlot(l.$slots,"default",{record:n})],8,L))),128))],4)],544)]))}};exports.default=z;
